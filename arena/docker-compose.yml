version: '3.8'

services:
  # IL BERSAGLIO (Difeso da Togusa)
  # Un server Linux completo con servizi vulnerabili ma tool difensivi (iptables, logs)
  blue_target:
    build:
      context: .
      dockerfile: Dockerfile.target
    container_name: arena_target
    hostname: target-server
    cap_add:
      - NET_ADMIN # Necessario per iptables
      - SYS_ADMIN
    networks:
      - cyber_ring
    # Simuliamo un server reale
    environment:
      - FLAG=SECTION9{TRAINING_COMPLETE}

  # L'ATTACCANTE (KaliAI Red Team)
  # Monta il codice attuale per usare le skill apprese
  red_attacker:
    build:
      context: .
      dockerfile: Dockerfile.attacker
    container_name: arena_attacker
    hostname: red-team
    tty: true
    command: tail -f /dev/null
    volumes:
      - ../:/app # Monta il codice di KaliAI
    working_dir: /app
    networks:
      - cyber_ring
    depends_on:
      - blue_target

networks:
  cyber_ring:
    driver: bridge
    internal: true # ISOLATO: Niente internet
    ipam:
      config:
        - subnet: 10.10.10.0/24
