#!/usr/bin/env python3
"""
Script per installare automaticamente tutti i tool di pentesting mancanti.
"""

import sys
import os
from pathlib import Path

# Add project root to path
PROJECT_ROOT = Path(__file__).parent.parent.parent
sys.path.insert(0, str(PROJECT_ROOT))

# Import from tools package
try:
    from tools.tool_manager import tool_manager
except ImportError:
    # Fallback for older structure
    sys.path.insert(0, str(PROJECT_ROOT / 'tools'))
    from tool_manager import tool_manager

def main():
    print("=" * 60)
    print("INSTALLAZIONE TOOL DI PENTESTING")
    print("=" * 60)
    
    # Statistiche iniziali
    stats = tool_manager.get_tool_stats()
    print(f"\nüìä Stato attuale:")
    print(f"   Tool totali: {stats['total_tools']}")
    print(f"   Installati: {stats['installed']}")
    print(f"   Mancanti: {stats['missing']}")
    print(f"   Coverage: {stats['coverage']}")
    
    # Lista tool mancanti
    missing = tool_manager.list_missing_tools()
    essential_missing = [t for t in missing if not t['optional']]
    
    if not essential_missing:
        print("\n‚úÖ Tutti i tool essenziali sono gi√† installati!")
        return 0
    
    print(f"\nüîß Tool essenziali da installare ({len(essential_missing)}):")
    for tool in essential_missing:
        print(f"   - {tool['name']}: {tool['description']}")
    
    # Conferma
    if len(sys.argv) > 1 and sys.argv[1] == '--yes':
        proceed = True
    else:
        resp = input("\nProcedere con l'installazione? [y/N]: ")
        proceed = resp.lower() in ['y', 'yes', 's', 'si']
    
    if not proceed:
        print("Installazione annullata.")
        return 1
    
    # Installazione
    print("\nüöÄ Installazione in corso...\n")
    results = tool_manager.install_pentest_suite()
    
    # Riepilogo
    print("\n" + "=" * 60)
    print("RIEPILOGO INSTALLAZIONE")
    print("=" * 60)
    
    success_count = sum(1 for v in results.values() if v)
    failed = [k for k, v in results.items() if not v]
    
    print(f"\n‚úÖ Installati con successo: {success_count}/{len(results)}")
    
    if failed:
        print(f"\n‚ùå Falliti ({len(failed)}):")
        for tool in failed:
            print(f"   - {tool}")
        print("\nInstalla manualmente con:")
        print(f"   sudo apt-get install {' '.join(failed)}")
    
    # Statistiche finali
    stats_final = tool_manager.get_tool_stats()
    print(f"\nüìä Coverage finale: {stats_final['coverage']}")
    
    return 0 if not failed else 1


if __name__ == "__main__":
    sys.exit(main())
